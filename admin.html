<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci贸n - ARVET</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <!-- Reemplaza el sidebar de admin.html con esto: -->

<aside class="sidebar">
    <div class="sidebar-header">
        <h2>ARVET</h2>
        <p id="userName">Cargando...</p>
        <small id="userRole" style="color: #94a3b8;">Rol</small>
    </div>
    
    <ul class="sidebar-menu">
        <li class="active" onclick="showSection('dashboard')">
            <span></span> Dashboard
        </li>
        <li onclick="showSection('partidos')">
            <span>锔</span> Partidos
        </li>
        <li onclick="showSection('cuotas')">
            <span></span> Cuotas
        </li>
        <li onclick="showSection('jugadores')">
            <span></span> Jugadores
        </li>
        <li onclick="showSection('finanzas')">
            <span></span> Finanzas
        </li>
        
        <!-- Separador visual -->
        <li style="border-top: 1px solid #334155; margin-top: 20px; padding-top: 20px;">
            <a href="equipo.html" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 10px; width: 100%;">
                <span></span> Ver Sitio P煤blico
            </a>
        </li>
        
        <!--  AQU VA EL LOGOUT -->
        <li onclick="logout()" style="color: #ef4444; cursor: pointer;">
            <span></span> Cerrar Sesi贸n
        </li>
    </ul>
</aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="section-content">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <span id="currentDate"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Jugadores Activos</h3>
                        <div class="stat-value" id="statJugadores">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Partidos este mes</h3>
                        <div class="stat-value" id="statPartidos">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recaudaci贸n mensual</h3>
                        <div class="stat-value" id="statRecaudacion">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Deuda total</h3>
                        <div class="stat-value text-danger" id="statDeuda">$0</div>
                    </div>
                </div>
            </div>

            <!-- Partidos -->
            <div id="partidos" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Partidos</h1>
                    <button class="btn-primary" onclick="nuevoPartido()">+ Nuevo Partido</button>
                </div>
                <div class="table-container">
                    <table id="tablaPartidos">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Rival</th>
                                <th>Lugar</th>
                                <th>Precio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Cuotas -->
            <div id="cuotas" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Cuotas</h1>
                </div>
                <div class="table-container">
                    <table id="tablaCuotas">
                        <thead>
                            <tr>
                                <th>Jugador</th>
                                <th>Tipo</th>
                                <th>Mes</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Jugadores -->
            <div id="jugadores" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Jugadores</h1>
                    <button class="btn-primary" onclick="nuevoJugador()">+ Nuevo Jugador</button>
                </div>
                <div class="table-container">
                    <table id="tablaJugadores">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Posici贸n</th>
                                <th>Email</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Finanzas -->
            <div id="finanzas" class="section-content hidden">
                <div class="page-header">
                    <h1>Resumen Financiero</h1>
                </div>
                <div id="finanzasContent">
                    <p>Cargando datos financieros...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script src="js/partidos.js"></script>
    <script src="js/cuotas.js"></script>
    <script>
// ============================================
// PROTECCIN DE RUTA - AGREGAR EN admin.html
// ============================================

function checkAuth() {
    const user = localStorage.getItem('arvet_user');
    
    if (!user) {
        // No hay sesi贸n, redirigir al login
        window.location.href = 'login.html';
        return null;
    }
    
    const userData = JSON.parse(user);
    
    // Verificar que tenga permisos de administraci贸n
    const rolesPermitidos = ['Admin', 'Capit谩n', 'Manager'];
    if (!rolesPermitidos.includes(userData.rol)) {
        alert('No tienes permisos para acceder a esta secci贸n');
        window.location.href = 'index.html';
        return null;
    }
    
    return userData;
}

// Ejecutar al cargar
const currentUser = checkAuth();
if (currentUser) {
    document.getElementById('userName').textContent = 
        `${currentUser.nombre} ${currentUser.apellido}`;
}
        // Verificar autenticaci贸n
        const user = checkAuth();
        document.getElementById('userName').textContent = `${user.nombre} ${user.apellido}`;
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('es-ES');
        
        // Cargar datos iniciales
        cargarDashboard();
        cargarPartidosAdmin();
        cargarJugadoresAdmin();
        cargarCuotasAdmin();

        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            // Mostrar la seleccionada
            document.getElementById(sectionId).classList.remove('hidden');
            // Actualizar men煤
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function cargarDashboard() {
            // Aqu铆 ir铆an las llamadas a la API para estad铆sticas
            document.getElementById('statJugadores').textContent = '25';
            document.getElementById('statPartidos').textContent = '4';
            document.getElementById('statRecaudacion').textContent = '$450.000';
            document.getElementById('statDeuda').textContent = '$125.000';
        }

        async function cargarJugadoresAdmin() {
            try {
                const response = await fetchAPI('getJugadores', { equipoId: user.equipoId });
                if (response.success) {
                    const tbody = document.querySelector('#tablaJugadores tbody');
                    tbody.innerHTML = response.data.map(j => `
                        <tr>
                            <td>${j.numeroCamiseta || '-'}</td>
                            <td>${j.nombre} ${j.apellido}</td>
                            <td>${j.posicion || '-'}</td>
                            <td>${j.email}</td>
                            <td><span class="badge badge-success">${j.estado}</span></td>
                            <td>
                                <button class="btn-action btn-edit" onclick="editarJugador('${j.id}')">Editar</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error(error);
            }
        }

        function nuevoJugador() {
            alert('Funci贸n para crear nuevo jugador');
        }

        function editarJugador(id) {
            alert('Editar jugador: ' + id);
        }
        // ============================================
// LOGOUT
// ============================================

function logout() {
    // Confirmar antes de salir (opcional)
    if (confirm('驴Est谩s seguro de que quer茅s cerrar sesi贸n?')) {
        // Limpiar todo el localStorage de ARVET
        localStorage.removeItem('arvet_user');
        localStorage.removeItem('arvet_login_time');
        localStorage.removeItem('arvet_equipo');
        
        // Redirigir al login
        window.location.href = 'login.html';
    }
}

// ============================================
// AUTO-LOGOUT POR INACTIVIDAD (opcional)
// ============================================

let inactivityTimer;
const INACTIVITY_LIMIT = 30 * 60 * 1000; // 30 minutos

function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
        alert('Sesi贸n expirada por inactividad');
        logout();
    }, INACTIVITY_LIMIT);
}

// Detectar actividad del usuario
document.addEventListener('mousemove', resetInactivityTimer);
document.addEventListener('keypress', resetInactivityTimer);
document.addEventListener('click', resetInactivityTimer);

// Iniciar el timer cuando carga la p谩gina
resetInactivityTimer();
    </script>
</body>
</html>
