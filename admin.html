<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci贸n - ARVET</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <!-- Reemplaza el sidebar de admin.html con esto: -->

<aside class="sidebar">
    <div class="sidebar-header">
        <h2>ARVET</h2>
        <p id="userName">Cargando...</p>
        <small id="userRole" style="color: #94a3b8;">Rol</small>
    </div>
    
    <ul class="sidebar-menu">
        <li class="active" onclick="showSection('dashboard')">
            <span></span> Dashboard
        </li>
        <li onclick="showSection('partidos')">
            <span>锔</span> Partidos
        </li>
        <li onclick="showSection('cuotas')">
            <span></span> Cuotas
        </li>
        <li onclick="showSection('jugadores')">
            <span></span> Jugadores
        </li>
        <li onclick="showSection('finanzas')">
            <span></span> Finanzas
        </li>
        
        <!-- Separador visual -->
        <li style="border-top: 1px solid #334155; margin-top: 20px; padding-top: 20px;">
            <button id="btnVerSitio" class="btn-full">
     Ver Sitio P煤blico
</button>
        </li>
        
        <!--  AQU VA EL LOGOUT -->
        <li onclick="logout()" style="color: #ef4444; cursor: pointer;">
            <span></span> Cerrar Sesi贸n
        </li>
    </ul>
</aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="section-content">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <span id="currentDate"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Jugadores Activos</h3>
                        <div class="stat-value" id="statJugadores">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Partidos este mes</h3>
                        <div class="stat-value" id="statPartidos">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recaudaci贸n mensual</h3>
                        <div class="stat-value" id="statRecaudacion">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Deuda total</h3>
                        <div class="stat-value text-danger" id="statDeuda">$0</div>
                    </div>
                </div>
            </div>

            <!-- Partidos -->
            <div id="partidos" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Partidos</h1>
                    <button class="btn-primary" onclick="nuevoPartido()">+ Nuevo Partido</button>
                </div>
                <div class="table-container">
                    <table id="tablaPartidos">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Rival</th>
                                <th>Lugar</th>
                                <th>Precio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Cuotas -->
            <div id="cuotas" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Cuotas</h1>
                </div>
                <div class="table-container">
                    <table id="tablaCuotas">
                        <thead>
                            <tr>
                                <th>Jugador</th>
                                <th>Tipo</th>
                                <th>Mes</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Jugadores -->
            <div id="jugadores" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Jugadores</h1>
                    <button class="btn-primary" onclick="nuevoJugador()">+ Nuevo Jugador</button>
                </div>
                <div class="table-container">
                    <table id="tablaJugadores">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Posici贸n</th>
                                <th>Email</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Finanzas -->
            <div id="finanzas" class="section-content hidden">
                <div class="page-header">
                    <h1>Resumen Financiero</h1>
                </div>
                <div id="finanzasContent">
                    <p>Cargando datos financieros...</p>
                </div>
            </div>
        </main>
    </div>
    <script src="js/app.js"></script>
    <script src="js/partidos.js"></script>
    <script src="js/cuotas.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    let currentUser = null;

try {
    const storedUser = localStorage.getItem('arvet_user');
    if (storedUser && storedUser !== "undefined") {
        currentUser = JSON.parse(storedUser);
    }
} catch (e) {
    console.error("Error parseando usuario:", e);
}
    //  Protecci贸n de sesi贸n
    if (!currentUser) {
    window.location.href = "login.html";
    return;
}
    // ===============================
    // DATOS USUARIO
    // ===============================

    const userNameEl = document.getElementById('userName');
    const userRoleEl = document.getElementById('userRole');
    const currentDateEl = document.getElementById('currentDate');

    if (userNameEl) userNameEl.textContent = currentUser.nombre || '';
    if (userRoleEl) userRoleEl.textContent = currentUser.rol || '';
    if (currentDateEl) {
        currentDateEl.textContent =
            new Date().toLocaleDateString('es-ES');
    }

// ===============================
// BOTN SITIO PBLICO
// ===============================

const btn = document.getElementById('btnVerSitio');

if (btn && currentUser.slug) {
    btn.addEventListener('click', function() {
        window.location.href = `/${currentUser.slug}`;
    });
} else if (btn && currentUser.equipoId) {
    // Fallback: si no hay slug, buscarlo manualmente
    btn.addEventListener('click', async function() {
        try {
            const response = await fetchAPI('getEquipoBySlug', { slug: currentUser.equipoId });
            if (response.success && response.data.slug) {
                window.location.href = `/${response.data.slug}`;
            } else {
                window.location.href = `/${currentUser.equipoId}`;
            }
        } catch (e) {
            window.location.href = `/${currentUser.equipoId}`;
        }
    });
}
    // ===============================
    // SECCIONES
    // ===============================

    window.showSection = function(sectionId) {
        document.querySelectorAll('.section-content')
            .forEach(el => el.classList.add('hidden'));

        const section = document.getElementById(sectionId);
        if (section) section.classList.remove('hidden');
    }

    // ===============================
    // DASHBOARD MOCK
    // ===============================

    async function cargarDashboard() {
        const statJugadores = document.getElementById('statJugadores');
        const statPartidos = document.getElementById('statPartidos');
        const statRecaudacion = document.getElementById('statRecaudacion');
        const statDeuda = document.getElementById('statDeuda');

        if (statJugadores) statJugadores.textContent = '25';
        if (statPartidos) statPartidos.textContent = '4';
        if (statRecaudacion) statRecaudacion.textContent = '$450.000';
        if (statDeuda) statDeuda.textContent = '$125.000';
    }

    // ===============================
    // JUGADORES
    // ===============================

    async function cargarJugadoresAdmin() {

        try {
            const response = await fetchAPI('getJugadores', {
                equipoId: currentUser.equipoId
            });

            if (response.success) {

                const tbody =
                    document.querySelector('#tablaJugadores tbody');

                if (!tbody) return;

                tbody.innerHTML = response.data.map(j => `
                    <tr>
                        <td>${j.numeroCamiseta || '-'}</td>
                        <td>${j.nombre} ${j.apellido || ''}</td>
                        <td>${j.posicion || '-'}</td>
                        <td>${j.email || '-'}</td>
                        <td>
                            <span class="badge badge-success">
                                ${j.rol || 'Jugador'}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action btn-edit"
                                onclick="editarJugador('${j.id}')">
                                Editar
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

        } catch (error) {
            console.error(error);
        }
    }

    window.nuevoJugador = function() {
        alert('Funci贸n para crear nuevo jugador');
    }

    window.editarJugador = function(id) {
        alert('Editar jugador: ' + id);
    }

    // ===============================
    // LOGOUT
    // ===============================

    window.logout = function() {
        if (confirm('驴Cerrar sesi贸n?')) {

            localStorage.removeItem('arvet_user');
            localStorage.removeItem('arvet_login_time');

            window.location.href = 'login.html';
        }
    }

    // ===============================
    // INICIALIZAR
    // ===============================

    cargarDashboard();
    cargarJugadoresAdmin();
    if (typeof cargarPartidosAdmin === 'function') cargarPartidosAdmin();
    if (typeof cargarCuotasAdmin === 'function') cargarCuotasAdmin();

});
</script>

</body>
</html>
    
    
   

