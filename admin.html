<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci贸n - ARVET</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <!-- Reemplaza el sidebar de admin.html con esto: -->

<aside class="sidebar">
    <div class="sidebar-header">
        <h2>ARVET</h2>
        <p id="userName">Cargando...</p>
        <small id="userRole" style="color: #94a3b8;">Rol</small>
    </div>
    
    <ul class="sidebar-menu">
        <li class="active" onclick="showSection('dashboard')">
            <span></span> Dashboard
        </li>
        <li onclick="showSection('partidos')">
            <span>锔</span> Partidos
        </li>
        <li onclick="showSection('cuotas')">
            <span></span> Cuotas
        </li>
        <li onclick="showSection('jugadores')">
            <span></span> Jugadores
        </li>
        <li onclick="showSection('finanzas')">
            <span></span> Finanzas
        </li>
        
        <!-- Separador visual -->
        <li style="border-top: 1px solid #334155; margin-top: 20px; padding-top: 20px;">
            <a id="btnVerSitio"
   style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 10px; width: 100%;">
    <span></span> Ver Sitio P煤blico
</a>
        </li>
        
        <!--  AQU VA EL LOGOUT -->
        <li onclick="logout()" style="color: #ef4444; cursor: pointer;">
            <span></span> Cerrar Sesi贸n
        </li>
    </ul>
</aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="section-content">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <span id="currentDate"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Jugadores Activos</h3>
                        <div class="stat-value" id="statJugadores">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Partidos este mes</h3>
                        <div class="stat-value" id="statPartidos">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recaudaci贸n mensual</h3>
                        <div class="stat-value" id="statRecaudacion">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Deuda total</h3>
                        <div class="stat-value text-danger" id="statDeuda">$0</div>
                    </div>
                </div>
            </div>

            <!-- Partidos -->
            <div id="partidos" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Partidos</h1>
                    <button class="btn-primary" onclick="nuevoPartido()">+ Nuevo Partido</button>
                </div>
                <div class="table-container">
                    <table id="tablaPartidos">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Rival</th>
                                <th>Lugar</th>
                                <th>Precio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Cuotas -->
            <div id="cuotas" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Cuotas</h1>
                </div>
                <div class="table-container">
                    <table id="tablaCuotas">
                        <thead>
                            <tr>
                                <th>Jugador</th>
                                <th>Tipo</th>
                                <th>Mes</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Jugadores -->
            <div id="jugadores" class="section-content hidden">
                <div class="page-header">
                    <h1>Gesti贸n de Jugadores</h1>
                    <button class="btn-primary" onclick="nuevoJugador()">+ Nuevo Jugador</button>
                </div>
                <div class="table-container">
                    <table id="tablaJugadores">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Posici贸n</th>
                                <th>Email</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Finanzas -->
            <div id="finanzas" class="section-content hidden">
                <div class="page-header">
                    <h1>Resumen Financiero</h1>
                </div>
                <div id="finanzasContent">
                    <p>Cargando datos financieros...</p>
                </div>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script src="js/partidos.js"></script>
    <script src="js/cuotas.js"></script>
    
<script>
// ============================================
// AUTH
// ============================================

function checkAuth() {
    const user = localStorage.getItem('arvet_user');

    if (!user) {
        window.location.href = 'login.html';
        return null;
    }

    const userData = JSON.parse(user);

    const rolesPermitidos = ['Admin', 'Capit谩n', 'Manager'];
    if (!rolesPermitidos.includes(userData.rol)) {
        alert('No tienes permisos para acceder a esta secci贸n');
        window.location.href = 'index.html';
        return null;
    }

    return userData;
}

const currentUser = checkAuth();

if (currentUser) {

    // Nombre usuario
    document.getElementById('userName').textContent =
        currentUser.nombre || '';

    document.getElementById('userRole').textContent =
        currentUser.rol || '';

    document.getElementById('currentDate').textContent =
        new Date().toLocaleDateString('es-ES');

    //  BOTN VER SITIO PBLICO
    if (currentUser.slug) {
        document.getElementById('btnVerSitio').href =
            `equipo.html?slug=${currentUser.slug}`;
    } else {
        // fallback si no tiene slug guardado
        document.getElementById('btnVerSitio').style.display = 'none';
    }

    // Cargas iniciales
    cargarDashboard();
    cargarPartidosAdmin();
    cargarJugadoresAdmin();
    cargarCuotasAdmin();
}

// ============================================
// SECCIONES
// ============================================

function showSection(sectionId) {
    document.querySelectorAll('.section-content')
        .forEach(el => el.classList.add('hidden'));

    document.getElementById(sectionId)
        .classList.remove('hidden');
}

// ============================================
// DASHBOARD MOCK
// ============================================

async function cargarDashboard() {
    document.getElementById('statJugadores').textContent = '25';
    document.getElementById('statPartidos').textContent = '4';
    document.getElementById('statRecaudacion').textContent = '$450.000';
    document.getElementById('statDeuda').textContent = '$125.000';
}

// ============================================
// JUGADORES
// ============================================

async function cargarJugadoresAdmin() {

    if (!currentUser) return;

    try {
        const response = await fetchAPI('getJugadores', {
            equipoId: currentUser.equipoId
        });

        if (response.success) {

            const tbody =
                document.querySelector('#tablaJugadores tbody');

            tbody.innerHTML = response.data.map(j => `
                <tr>
                    <td>${j.numeroCamiseta || '-'}</td>
                    <td>${j.nombre} ${j.apellido || ''}</td>
                    <td>${j.posicion || '-'}</td>
                    <td>${j.email || '-'}</td>
                    <td>
                        <span class="badge badge-success">
                            ${j.rol || 'Jugador'}
                        </span>
                    </td>
                    <td>
                        <button class="btn-action btn-edit"
                            onclick="editarJugador('${j.id}')">
                            Editar
                        </button>
                    </td>
                </tr>
            `).join('');
        }

    } catch (error) {
        console.error(error);
    }
}

function nuevoJugador() {
    alert('Funci贸n para crear nuevo jugador');
}

function editarJugador(id) {
    alert('Editar jugador: ' + id);
}

// ============================================
// LOGOUT
// ============================================

function logout() {
    if (confirm('驴Est谩s seguro de que quer茅s cerrar sesi贸n?')) {

        localStorage.removeItem('arvet_user');
        localStorage.removeItem('arvet_login_time');
        localStorage.removeItem('arvet_equipo');

        window.location.href = 'login.html';
    }
}
</script>
</body>
</html>
