<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipo - ARVET</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">ARVET</a>
            <div class="nav-links">
                <a href="#portada">Inicio</a>
                <a href="#quienes-somos">Nosotros</a>
                <a href="#plantel">Plantel</a>
                <a href="#partidos">Partidos</a>
                <a href="login.html" class="btn-login">Login</a>
            </div>
        </div>
    </nav>

    <!-- Portada -->
    <section id="portada" class="hero" style="margin-top: 70px;">
        <div class="container">
            <div id="equipoHeader">
                <div class="loading">Cargando equipo...</div>
            </div>
        </div>
    </section>

    <!-- Qui√©nes Somos -->
    <section id="quienes-somos" class="section">
        <div class="container">
            <h2>üìã Qui√©nes Somos</h2>
            <div id="quienesSomosContent" class="card">
                <div class="loading">Cargando informaci√≥n...</div>
            </div>
        </div>
    </section>

    <!-- Comisi√≥n -->
    <section id="comision" class="section" style="background: #f1f5f9;">
        <div class="container">
            <h2>üë• Comisi√≥n Directiva</h2>
            <div id="comisionGrid" class="results-grid">
                <div class="loading">Cargando comisi√≥n...</div>
            </div>
        </div>
    </section>

    <!-- Plantel -->
    <section id="plantel" class="section">
        <div class="container">
            <h2>‚öΩ Plantel</h2>
            <div id="plantelGrid" class="results-grid">
                <div class="loading">Cargando plantel...</div>
            </div>
        </div>
    </section>

    <!-- Partidos -->
    <section id="partidos" class="section" style="background: #f1f5f9;">
        <div class="container">
            <h2>‚öîÔ∏è Pr√≥ximos Partidos</h2>
            <div id="partidosEquipoList" class="partidos-list">
                <div class="loading">Cargando partidos...</div>
            </div>
        </div>
    </section>

    <!-- Galer√≠a -->
    <section id="galeria" class="section">
        <div class="container">
            <h2>üì∏ Galer√≠a</h2>
            <div id="galeriaGrid" class="paises-grid">
                <p>Galer√≠a de fotos del equipo</p>
            </div>
        </div>
        
    </section>
<!-- Mapa -->
<section id="ubicacion" class="section" style="background: #f1f5f9;">
    <div class="container">
        <h2>üìç Ubicaci√≥n</h2>
        <div id="map" style="height: 400px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
    </div>
</section>
      
                <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INICIO ===');
            console.log('URL completa:', window.location.href);
            console.log('Search:', window.location.search);
            console.log('Pathname:', window.location.pathname);
            
            let slug = null;
            
            // OPCI√ìN 1: URL con ?slug=vvv (formato query string)
            const urlParams = new URLSearchParams(window.location.search);
            slug = urlParams.get('slug');
            console.log('Slug de query params:', slug);
            
            // OPCI√ìN 2: URL tipo /equipo332xx (formato pathname)
            if (!slug) {
                const path = window.location.pathname;
                // Obtener el √∫ltimo segmento de la ruta
                const segments = path.split('/').filter(s => s);
                const lastSegment = segments[segments.length - 1];
                
                console.log('√öltimo segmento:', lastSegment);
                
                // Limpiar .html si existe
                slug = lastSegment.replace('.html', '');
                console.log('Slug limpio:', slug);
            }
            
            console.log('Slug final:', slug);
            
            if (!slug || slug === '' || slug === 'equipo') {
                console.error('‚ùå No se encontr√≥ slug v√°lido');
                document.getElementById('equipoHeader').innerHTML = 
                    '<div class="error">Error: No se pudo identificar el equipo</div>';
                return;
            }
            
            console.log('‚úÖ Slug v√°lido:', slug);
            cargarEquipo(slug);
        });

        async function cargarEquipo(slug) {
            console.log('=== cargarEquipo ===');
            console.log('Llamando con slug:', slug);
            
            try {
                if (typeof fetchAPI !== 'function') {
                    console.error('fetchAPI no est√° definido');
                    return;
                }
                
                // IMPORTANTE: Enviar slug como par√°metro expl√≠cito
                console.log('Enviando a API: action=getEquipoBySlug, slug=' + slug);
                const response = await fetchAPI('getEquipoBySlug', { slug: slug });
                console.log('Respuesta:', response);

                if (!response.success) {
                    console.error('Error:', response.error);
                    document.getElementById('equipoHeader').innerHTML = 
                        `<div class="error">Error: ${response.error}</div>`;
                    return;
                }

                const equipo = response.data;
                console.log('Equipo:', equipo.nombre);
                console.log('Coordenadas:', equipo.lat, equipo.lng);

                // Actualizar UI
                document.getElementById('equipoHeader').innerHTML = `
                    <h1>${equipo.nombre}</h1>
                    <p>${equipo.ciudad}, ${equipo.pais}</p>
                    <p>${equipo.descripcion || ''}</p>
                `;

                document.getElementById('quienesSomosContent').innerHTML = `
                    <p>${equipo.historia || 'Sin informaci√≥n disponible'}</p>
                    <p><strong>Fundaci√≥n:</strong> ${equipo.fechaFundacion || 'N/A'}</p>
                    <p><strong>Colores:</strong> ${equipo.colores || 'N/A'}</p>
                `;

                // Cargar datos adicionales
                if (equipo.id) {
                    cargarJugadores(equipo.id);
                    cargarPartidosEquipo(equipo.id);
                }

                // Configurar mapa
                if (equipo.lat && equipo.lng) {
                    console.log('‚úÖ Tiene coordenadas:', equipo.lat, equipo.lng);
                    window.equipoCoords = {
                        lat: equipo.lat,
                        lng: equipo.lng
                    };
                } else {
                    console.log('‚ö†Ô∏è Sin coordenadas, usando default');
                    window.equipoCoords = {
                        lat: -34.6037,
                        lng: -58.3816
                    };
                }
                
                if (typeof inicializarMapa === 'function') {
                    inicializarMapa();
                }

            } catch (error) {
                console.error('‚ùå Error en cargarEquipo:', error);
                document.getElementById('equipoHeader').innerHTML = 
                    '<div class="error">Error de conexi√≥n</div>';
            }
        }

        async function cargarJugadores(equipoId) {
            try {
                const response = await fetchAPI('getJugadores', { equipoId });
                if (!response.success) return;
                
                const jugadores = response.data;
                const comision = jugadores.filter(j => j.rol && j.rol !== 'Jugador');
                const plantel = jugadores.filter(j => !j.rol || j.rol === 'Jugador');
                
                document.getElementById('comisionGrid').innerHTML = comision.map(j => `
                    <div class="card">
                        <h3>${j.nombre} ${j.apellido}</h3>
                        <p class="badge badge-success">${j.rol}</p>
                    </div>
                `).join('') || '<p>Sin comisi√≥n registrada</p>';
                
                document.getElementById('plantelGrid').innerHTML = plantel.map(j => `
                    <div class="card">
                        <h3>#${j.numeroCamiseta || '-'} ${j.nombre} ${j.apellido}</h3>
                        <p>${j.posicion || 'Jugador'}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error cargando jugadores:', error);
            }
        }

        async function cargarPartidosEquipo(equipoId) {
            try {
                const response = await fetchAPI('getPartidos', { equipoId });
                if (!response.success) return;
                
                document.getElementById('partidosEquipoList').innerHTML = response.data.map(partido => {
                    const fecha = formatDate(partido.fecha);
                    return `
                        <div class="partido-card">
                            <div class="partido-info">
                                <h3>vs ${partido.rival}</h3>
                                <div class="partido-meta">
                                    <span>üìç ${partido.lugar}</span>
                                    <span>üïê ${partido.hora}</span>
                                </div>
                            </div>
                            <div class="partido-fecha">
                                <div class="dia">${fecha.dia}</div>
                                <div class="mes">${fecha.mes}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando partidos:', error);
            }
        }
    </script>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script>
        let mapaCreado = false;
        let mapInstance = null;

        function inicializarMapa() {
            console.log('=== inicializarMapa ===');
            
            if (mapaCreado && mapInstance) {
                console.log('Actualizando mapa existente...');
                if (window.equipoCoords) {
                    const lat = parseFloat(window.equipoCoords.lat);
                    const lng = parseFloat(window.equipoCoords.lng);
                    mapInstance.setView([lat, lng], 15);
                    
                    mapInstance.eachLayer(layer => {
                        if (layer instanceof L.Marker) mapInstance.removeLayer(layer);
                    });
                    
                    L.marker([lat, lng]).addTo(mapInstance)
                        .bindPopup("üìç Ubicaci√≥n del equipo")
                        .openPopup();
                }
                return;
            }
            
            const lat = window.equipoCoords ? parseFloat(window.equipoCoords.lat) : -34.6037;
            const lng = window.equipoCoords ? parseFloat(window.equipoCoords.lng) : -58.3816;
            const zoom = window.equipoCoords ? 15 : 13;
            
            console.log('Creando mapa en:', lat, lng);
            
            mapInstance = L.map('map').setView([lat, lng], zoom);
            mapaCreado = true;
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(mapInstance);
            
            L.marker([lat, lng]).addTo(mapInstance)
                .bindPopup("üìç Ubicaci√≥n del equipo")
                .openPopup();
                
            console.log('‚úÖ Mapa creado');
        }
    </script>
    </body>
</html>
